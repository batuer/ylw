title:  Android多进程
date: 2018年3月26日08:23:34
categories: 多进程
tags: 

	 - Android
	 - 多进程
cover_picture: /images/common.png
---

### 多进程概念

多进程就是多个进程。一个应用程序默认只有一个进程，这个进程的名称就是报名。

- 进程是系统资源个分配的基本单位，线程死调度的基本单位。
- 每个进程都有自己独立的资源和内存空间。
- 其它进程不可随意访问其它进程的内存和资源。
- 系统给每个进程分配的内存有限制。

### 多进程的创建

四大组件在AndroidManifset文件中注册的时候，有个属性android:process这里可以指定组件多出的进程。默认主进程。android:process=”:deamon”以:开头的名字位私有进程，否则全局进程。

### 多进程的优缺点

- 好处
  - 分担主进程内存压力，将一些独立的组件放到不同的进程中，它就不占用主进程的内存空间，如大图片或多图片的组件或WebView。
  - 帮助应用常驻后台，防止主进程被杀守护进程，主进程与守护进程相互监视唤醒。
- 坏处
  - 消耗用电
  - 多占用系统空间
  - 必要时需要处理多进程间通信。

### 多进程的缺陷

- Application多次重建
  - 获取进程id获取进程名称，处理相应进程的业务
- 静态成员失效
  - 使用Intent或aidl等进程通信方式传递内容，不能使用静态或单例模式。
- 文件共享问题
  - 多进程并发操作数据库，难以通过锁机制控制，考虑都使用主进程进行数据库操作(ContentProvider)。
- 断点调试问题
  - 调试就是跟踪程序运行过程中的堆栈信息，由于每个进程都有自己独立的内存空间和各自的堆栈，无法实现在不同的进程间调试。因此要改为同一进程：调试时去掉AndroidManifest.xml中android:process标签，这样保证调试状态下是在同一进程中，堆栈信息是连贯的。待调试完成后，再将标签复原。

### 多进程间通信IPC

- 通过Intent/Bundle传递数据
- 通过文件缓存，一个进程写另一个进程读取
- 通过ContentProvider提供入口，共享数据
- 通过Socket方式，系统中的进程服务也有如此方式
- 通过AIDL实现进程通信，可以做到多端连接，异步通信，避免阻塞
- Messenger
  - 利用Handler实现，适用于多进程、单线程、不需要考虑线程安全。底层基于AIDL实现。
- 通过广播